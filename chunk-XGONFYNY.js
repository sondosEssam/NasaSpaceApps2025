import{c as H}from"./chunk-F63ZZR6Y.js";import{a as A}from"./chunk-6J3KBWRV.js";import{$ as F,Da as f,Ha as p,Lb as k,Mb as R,Nb as L,O as w,Ob as O,S as _,Wa as l,Xa as a,Ya as i,Za as d,_ as u,bb as x,cb as b,eb as y,fb as C,ja as S,jb as v,lb as n,mb as D,nb as m,ua as o,vb as E,wb as T,za as I}from"./chunk-HSYZIOVM.js";var g=class r{foreCastData;forecasrtChartData={datasets:[]};forecastChartOptions={};selectedTimeRange="hours";filteredForeCastData;ngOnInit(){this.setUpChartOptions(),this.updateForeCastChart()}ngOnChanges(t){t.foreCastData&&this.foreCastData?.length&&this.updateForeCastChart()}onTimeChange(){this.filterDataByTimeRange(),this.updateForeCastChart()}setUpChartOptions(){this.forecastChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"pollution data over time"}},scales:{x:{display:!0,title:{display:!0,text:"Time"}},y:{display:!0,title:{display:!0,text:"Aerosol Optical Depth"},beginAtZero:!1,grace:"50%"}}}}filterDataByTimeRange(){switch(this.selectedTimeRange){case"hours":this.filteredForeCastData=this.foreCastData.slice(-24);break;case"weekly":this.filteredForeCastData=this.foreCastData.filter((t,e)=>e%24===0).slice(-7);break;case"monthly":this.filteredForeCastData=this.foreCastData.filter((t,e)=>e%24===0).slice(-30);break;default:this.filteredForeCastData=this.foreCastData}}formatTimestamp(t){let e=new Date(t);switch(this.selectedTimeRange){case"daily":return e.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit"});case"weekly":return e.toLocaleString("en-US",{month:"short",day:"numeric"});case"monthly":return e.toLocaleString("en-US",{month:"short",day:"numeric"});default:return e.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}}getTimeRangeDisplayName(){switch(this.selectedTimeRange){case"daily":return"Daily (by Hours)";case"weekly":return"Weekly (by Days)";case"monthly":return"Monthly (by Days)";default:return"All Data"}}updateForeCastChart(){console.log(this.foreCastData),this.filterDataByTimeRange(),console.log(this.filteredForeCastData);let t=this.filteredForeCastData.map(c=>this.formatTimestamp(c.time)),e=this.filteredForeCastData.map(c=>c.AQI_pred);console.log(e);let s=this.filteredForeCastData.map(c=>c.AQI_pred);this.forecasrtChartData={labels:t,datasets:[{label:"Predicditions",data:e,borderColor:"rgba(255, 99, 132, 1)",backgroundColor:"rgba(255, 99, 132, 0.2)",fill:!0,borderWidth:2,tension:.4},{label:"AOD",data:e,borderColor:"rgba(54, 162, 235, 1)",backgroundColor:"rgba(54, 162, 235, 0.2)",fill:!1,borderWidth:2,tension:.4},{label:"Probability",data:s,borderColor:"rgba(255, 206, 86, 1)",backgroundColor:"rgba(255, 206, 86, 0.2)",fill:!1,borderWidth:2,tension:.4}]}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=f({type:r,selectors:[["app-forecast-chart"]],inputs:{foreCastData:"foreCastData"},features:[S],decls:17,vars:5,consts:[[1,"p-8","mx-auto","h-[100vh]","w-full"],[1,"text-2xl","font-bold","text-center","text-gray-600"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8","mb-8"],[1,"bg-gray-50","bg-opacity-90","p-6","rounded-lg","shadow-sm","w-full"],[1,"text-xl","font-semibold","mb-4","text-gray-800"],[1,"h-80","flex","flex-col","align-center","justify-center","w-full"],[2,"display","block","width","100%"],["baseChart","",3,"data","options","type"],[1,"bg-green-50","p-4","rounded-lg"],[1,"font-semibold","text-green-800"]],template:function(e,s){e&1&&(a(0,"div",0)(1,"h1",1),n(2,"ForeCast Results"),i(),a(3,"div",2)(4,"div",3)(5,"h2",4),n(6," Chart"),i(),a(7,"div",5)(8,"div",6),d(9,"canvas",7),i()()()(),a(10,"div",8)(11,"h3",9),n(12,"Data Summary"),i(),a(13,"p"),n(14),i(),a(15,"p"),n(16),i()()()),e&2&&(o(9),l("data",s.forecasrtChartData)("options",s.forecastChartOptions)("type","line"),o(5),m("Forecast records: ",s.foreCastData.length),o(2),m("time range: ",s.selectedTimeRange))},dependencies:[H],encapsulation:2})};var h=class r{constructor(t){this.http=t}baseUrl="http://localhost:5000/api/predict";getForecastData(t){let e={hours:t.hours,start_time:t.start_time.toISOString()};return this.http.get(`${this.baseUrl}`,{params:e})}static \u0275fac=function(e){return new(e||r)(_(A))};static \u0275prov=w({token:r,factory:r.\u0275fac,providedIn:"root"})};function j(r,t){r&1&&(u(),a(0,"svg",11),d(1,"circle",12)(2,"path",13),i())}function U(r,t){r&1&&(a(0,"div",14)(1,"div",15),u(),a(2,"svg",16),d(3,"circle",12)(4,"path",13),i(),F(),a(5,"h3",17),n(6,"Loading Forecast Data"),i(),a(7,"p",18),n(8,"Please wait while we fetch your air quality forecast..."),i(),a(9,"div",19),d(10,"div",20),i()()())}function W(r,t){if(r&1&&(a(0,"tr",30)(1,"td",31),n(2),E(3,"date"),i(),a(4,"td",32),n(5),i(),a(6,"td",31)(7,"span",33),n(8),i()()()),r&2){let e=t.$implicit;o(2),D(T(3,17,e==null?null:e.time,"medium")),o(2),v("text-green-400",e.AQI_pred<100)("text-yellow-400",e.AQI_pred>=100&&e.AQI_pred<200)("text-red-400",e.AQI_pred>=200),o(),m(" ",e==null?null:e.AQI_pred," "),o(2),v("bg-green-500/20",!e.polluted)("text-green-400",!e.polluted)("bg-red-500/20",e.polluted)("text-red-400",e.polluted),o(),m(" ",e.polluted?"Polluted":"Not Polluted"," ")}}function z(r,t){if(r&1&&(x(0),p(1,W,9,20,"tr",29),b()),r&2){let e=C(2);o(),l("ngForOf",e.forecastData)}}function G(r,t){if(r&1&&(x(0),a(1,"div",21)(2,"h2",22),n(3," Forecast Results "),i(),a(4,"div",23)(5,"table",24)(6,"thead",25)(7,"tr")(8,"th",26),n(9,"Date"),i(),a(10,"th",26),n(11,"AQI"),i(),a(12,"th",26),n(13,"Pollution Result"),i()()(),a(14,"tbody",27),p(15,z,2,1,"ng-container",10),i()()()(),d(16,"app-forecast-chart",28),b()),r&2){let e=C();o(15),l("ngIf",e.forecastData&&e.forecastData.length!=0),o(),l("foreCastData",e.forecastData)}}var P=class r{constructor(t){this.forCastService=t}selectedTimeRange="Hours";forecastData=[];hours;body;resultClicked=!1;isLoading=!1;start_time=new Date;onTimeRangeChange(t){let e=t.target;this.selectedTimeRange=e.value,this.hoursHandler()}hoursHandler(){switch(this.selectedTimeRange){case"Hours":this.hours=24;break;case"Days":this.hours=168;break;case"Weeks":this.hours=672;break}this.body={hours:this.hours,start_time:this.start_time}}getForecast(){this.hoursHandler(),console.log(this.body),this.isLoading=!0,this.resultClicked=!0,this.forCastService.getForecastData(this.body).subscribe({next:t=>{console.log(t),t&&(this.forecastData=t.predictions,console.log(this.forecastData)),this.isLoading=!1},error:t=>{console.log(t),console.log(this.body),this.isLoading=!1}})}static \u0275fac=function(e){return new(e||r)(I(h))};static \u0275cmp=f({type:r,selectors:[["app-forecast"]],decls:18,vars:5,consts:[[1,"flex","flex-col","justify-center","items-center","mx-auto","w-[90%]","min-h-[150vh]"],[1,"md:text-3xl","text-xl","font-bold","mb-4","text-center","m-1"],[1,"md:text-sm","text-xs","font-bold","m-1","text-gray-600"],["name","timeRange","id","timerange",1,"p-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","mb-4",3,"change"],["value","Hours"],["value","Days"],["value","Months"],[1,"px-6","py-2","bg-blue-500","text-white","rounded-md","hover:bg-blue-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","transition",3,"click","disabled"],["class","animate-spin h-4 w-4 text-white","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",4,"ngIf"],[4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-4","w-4","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","p-8","rounded-lg","shadow-xl","flex","flex-col","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-12","w-12","text-blue-500","mb-4"],[1,"text-lg","font-semibold","text-gray-800","mb-2"],[1,"text-gray-600","text-center"],[1,"w-64","bg-gray-200","rounded-full","h-2","mt-4"],[1,"bg-blue-500","h-2","rounded-full","animate-pulse",2,"width","60%"],[1,"pred-result","mt-8","p-6","bg-gray-900","rounded-2xl","shadow-lg","text-gray-200","w-full","max-w-5xl"],[1,"text-2xl","font-semibold","mb-4","text-center","text-teal-400"],[1,"overflow-auto","h-[360px]"],[1,"min-w-full","border","border-gray-700","rounded-lg","overflow-scroll"],[1,"bg-gray-800","text-gray-300","uppercase","text-sm"],[1,"py-3","px-6","text-left"],[1,"divide-y","divide-gray-700"],[1,"w-full",3,"foreCastData"],["class","hover:bg-gray-800 transition-colors duration-150",4,"ngFor","ngForOf"],[1,"hover:bg-gray-800","transition-colors","duration-150"],[1,"py-3","px-6"],[1,"py-3","px-6","font-semibold","text-lg"],[1,"px-3","py-1","rounded-full","text-sm","font-medium"]],template:function(e,s){e&1&&(a(0,"div",0)(1,"h1",1),n(2,"Day Air Quality Forecast"),i(),a(3,"p",2),n(4," Discover the air quality or pollution levels in your area "),i(),a(5,"select",3),y("change",function(B){return s.onTimeRangeChange(B)}),a(6,"option",4),n(7,"Hours"),i(),a(8,"option",5),n(9,"Days"),i(),a(10,"option",6),n(11,"Months"),i()(),a(12,"button",7),y("click",function(){return s.getForecast()}),p(13,j,3,0,"svg",8),a(14,"span"),n(15),i()(),p(16,U,11,0,"div",9)(17,G,17,2,"ng-container",10),i()),e&2&&(o(12),l("disabled",s.isLoading),o(),l("ngIf",s.isLoading),o(2),D(s.isLoading?"Loading...":"Get Forecast"),o(),l("ngIf",s.isLoading&&s.resultClicked),o(),l("ngIf",s.resultClicked&&!s.isLoading))},dependencies:[O,k,R,g,L],encapsulation:2})};export{P as Forecast};
